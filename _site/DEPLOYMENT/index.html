<h1>Deployment Guide for KV Garage</h1>
<h2>Issue: Export Syntax Errors in Production</h2>
<p>If you're seeing errors like <code>Uncaught SyntaxError: Unexpected token 'export'</code> in production but not locally, this is likely a <strong>caching issue</strong>.</p>
<h3>Root Cause</h3>
<p>Netlify may be serving cached versions of your JavaScript files that contain old <code>export</code> statements. The local files have been updated, but the production cache hasn't been cleared.</p>
<h2>Solution: Clear Netlify Cache and Redeploy</h2>
<h3>Option 1: Clear Cache via Netlify Dashboard (Recommended)</h3>
<ol>
<li>Go to your Netlify dashboard</li>
<li>Navigate to your site</li>
<li>Go to <strong>Deploys</strong> tab</li>
<li>Click <strong>Deploy settings</strong></li>
<li>Scroll down to <strong>Build &amp; deploy</strong></li>
<li>Click <strong>Clear cache and retry deploy</strong></li>
</ol>
<h3>Option 2: Clear Cache via Command Line</h3>
<pre><code class="language-bash"># Install Netlify CLI if you haven't already
npm install -g netlify-cli

# Login to Netlify
netlify login

# Link your local repository to the Netlify site
netlify link

# Clear cache and trigger a new build
netlify build --clear-cache
netlify deploy --prod
</code></pre>
<h3>Option 3: Force New Deployment</h3>
<ol>
<li>Make a small change to trigger a new deployment (e.g., add a comment to a file)</li>
<li>Commit and push to your repository</li>
<li>Netlify will automatically rebuild</li>
</ol>
<pre><code class="language-bash"># Example: Update a comment in netlify.toml
git commit --allow-empty -m &quot;Force rebuild to clear cache&quot;
git push origin main
</code></pre>
<h2>Prevention: Updated Configuration</h2>
<p>The following changes have been made to prevent future caching issues:</p>
<h3>1. Updated <code>netlify.toml</code></h3>
<ul>
<li>JavaScript files now have a shorter cache time (1 hour instead of 1 year)</li>
<li><code>must-revalidate</code> directive ensures browser checks for updates</li>
<li>Explicit <code>Content-Type</code> header for JavaScript files</li>
</ul>
<h3>2. Build Verification Script</h3>
<p>A new <code>verify-build.js</code> script runs after each build to check for:</p>
<ul>
<li>Export statements in JavaScript files</li>
<li>Missing required files</li>
<li>Build integrity issues</li>
</ul>
<p>Run manually with:</p>
<pre><code class="language-bash">npm run verify
</code></pre>
<h3>3. Updated Build Commands</h3>
<ul>
<li><code>npm run build</code> - Standard build with verification</li>
<li><code>npm run build:prod</code> - Production build with verification</li>
<li><code>npm run verify</code> - Run verification without rebuilding</li>
</ul>
<h2>Troubleshooting</h2>
<h3>If the error persists after clearing cache:</h3>
<ol>
<li><strong>Check browser cache</strong>: Clear your browser cache or use incognito mode</li>
<li><strong>Check Netlify logs</strong>: Review build logs in Netlify dashboard for errors</li>
<li><strong>Verify build output</strong>: Run <code>npm run verify</code> locally to check for issues</li>
<li><strong>Check file timestamps</strong>: Ensure updated files are in the <code>public/</code> directory</li>
</ol>
<h3>Hard refresh in browser:</h3>
<ul>
<li><strong>Chrome/Edge</strong>: Ctrl + Shift + R (Windows) or Cmd + Shift + R (Mac)</li>
<li><strong>Firefox</strong>: Ctrl + Shift + R (Windows) or Cmd + Shift + R (Mac)</li>
<li><strong>Safari</strong>: Cmd + Option + R</li>
</ul>
<h2>Configuration Files Modified</h2>
<ol>
<li><code>.nvmrc</code> - Specifies Node.js version for Netlify</li>
<li><code>netlify.toml</code> - Updated cache headers for JavaScript files</li>
<li><code>package.json</code> - Added verification scripts</li>
<li><code>verify-build.js</code> - New build verification script</li>
</ol>
<h2>Next Steps</h2>
<ol>
<li>Clear Netlify cache using one of the methods above</li>
<li>Verify the deployment succeeded</li>
<li>Test the admin dashboard in production</li>
<li>If issues persist, check the browser console for specific errors</li>
</ol>
<h2>Support</h2>
<p>If you continue to experience issues after following these steps:</p>
<ol>
<li>Check the Netlify build logs for errors</li>
<li>Verify all JavaScript files are being copied to <code>public/assets/js/</code></li>
<li>Ensure the build completes successfully with <code>npm run build</code></li>
<li>Run <code>npm run verify</code> to check for build issues</li>
</ol>
